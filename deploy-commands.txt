# 阿里云服务器部署命令
# 服务器IP: 8.136.220.66
# 
# 使用方法：
# 1. 使用 SSH 连接到服务器
# 2. 复制下面的命令到服务器上执行
# 或者
# 3. 使用 scp 上传 deploy-to-server.sh 到服务器，然后执行

# ============================================
# 方法1: 直接在服务器上执行命令
# ============================================

# 步骤1: 更新系统
apt update && apt upgrade -y

# 步骤2: 安装 Node.js
curl -fsSL https://deb.nodesource.com/setup_18.x | bash -
apt-get install -y nodejs

# 步骤3: 安装 Git
apt install git -y

# 步骤4: 安装 PM2
npm install -g pm2

# 步骤5: 创建项目目录并克隆代码
mkdir -p /var/www
cd /var/www
git clone https://github.com/mhlutong/fightdesignagent.git
cd fightdesignagent

# 步骤6: 安装依赖
npm install

# 步骤7: 创建 .env 文件
cat > .env << 'EOF'
DEEPSEEK_API_KEY=sk-96abdfaa73754608aaa4292f02824d8d
NODE_ENV=production
PORT=3000
EOF

# 步骤8: 启动应用
pm2 start server.js --name heroschool-agent

# 步骤9: 设置开机自启
pm2 startup
pm2 save

# 步骤10: 查看状态
pm2 list

# ============================================
# 方法2: 上传脚本文件后执行
# ============================================
# 在本地执行（需要输入服务器密码）:
# scp deploy-to-server.sh root@8.136.220.66:/root/
# 
# 然后在服务器上执行:
# ssh root@8.136.220.66
# chmod +x /root/deploy-to-server.sh
# /root/deploy-to-server.sh
